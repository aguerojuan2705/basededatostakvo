<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Negocios Takvo</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Estilos personalizados para la estética */
        :root {
            --primary-color: #3b82f6; /* Tailwind blue-500 */
            --secondary-color: #f59e0b; /* Tailwind amber-500 */
            --danger-color: #ef4444; /* Tailwind red-500 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* Estilo general de botón */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }

        /* Estilo para la tabla */
        .table-container {
            overflow-x: auto;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        th {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            background-color: #e5e7eb;
            user-select: none;
            text-align: left;
            font-size: 0.875rem;
            font-weight: 700;
            color: #1f2937;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        td {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
        }

        tr:hover {
            background-color: #f9fafb;
        }

        /* Estilos de Modales */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Oculto por defecto */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Botones de acción en la tabla */
        .action-btn {
            margin: 0 0.25rem;
            padding: 0.4rem 0.5rem;
            border-radius: 0.375rem;
            background-color: #e5e7eb;
            color: #1f2937;
            transition: background-color 0.2s, color 0.2s;
        }
        .action-btn:hover {
            background-color: #d1d5db;
        }

        .contact-btn { color: var(--secondary-color); }
        .edit-btn { color: var(--primary-color); }
        .delete-btn { color: var(--danger-color); }
        .status-cell { text-align: center; }
        .no-link-style { text-decoration: none; color: inherit; }

        /* Estilos para el modal de contacto */
        #contact-history-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        #contact-history-list li {
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e5e7eb;
        }
        
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Encabezado y Estadísticas -->
    <header class="mb-8">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">CRM Takvo</h1>
        <p class="text-gray-600 mb-6">Gestión de Negocios y Seguimiento de Contacto</p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-blue-500">
                <p class="text-sm font-medium text-gray-500">Total Negocios</p>
                <p id="total-negocios" class="text-2xl font-bold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-amber-500">
                <p class="text-sm font-medium text-gray-500">Países Únicos</p>
                <p id="total-paises" class="text-2xl font-bold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-green-500 hidden sm:block">
                <p class="text-sm font-medium text-gray-500">Provincias</p>
                <p id="total-provincias" class="text-2xl font-bold text-gray-900">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-red-500 hidden sm:block">
                <p class="text-sm font-medium text-gray-500">Ciudades</p>
                <p id="total-ciudades" class="text-2xl font-bold text-gray-900">0</p>
            </div>
        </div>
    </header>

    <!-- Filtros y Acciones -->
    <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
        <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-4 mb-4">
            <div class="flex-grow">
                <label for="busqueda" class="block text-sm font-medium text-gray-700 mb-1">Buscar por Nombre:</label>
                <input type="text" id="busqueda" placeholder="Ej: Concesionaria Martínez" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            </div>
            <button id="btn-add-business" class="btn btn-primary whitespace-nowrap flex items-center justify-center">
                <i class="fas fa-plus mr-2"></i> Agregar Negocio
            </button>
        </div>

        <!-- Selectores de Filtro -->
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div>
                <label for="pais" class="block text-sm font-medium text-gray-700 mb-1">País:</label>
                <select id="pais" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
            <div>
                <label for="provincia" class="block text-sm font-medium text-gray-700 mb-1">Provincia:</label>
                <select id="provincia" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
            <div>
                <label for="ciudad" class="block text-sm font-medium text-gray-700 mb-1">Ciudad:</label>
                <select id="ciudad" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
            <div>
                <label for="rubro" class="block text-sm font-medium text-gray-700 mb-1">Rubro:</label>
                <select id="rubro" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
        </div>
    </div>

    <!-- Tabla de Negocios -->
    <div class="table-container bg-white">
        <table id="tabla-negocios" class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr>
                    <th data-sort="nombre" class="sortable">Nombre</th>
                    <th data-sort="telefono" class="sortable">Teléfono</th>
                    <th data-sort="rubro" class="sortable hidden md:table-cell">Rubro</th>
                    <th data-sort="ciudad" class="sortable hidden md:table-cell">Ciudad</th>
                    <th data-sort="provincia" class="sortable hidden lg:table-cell">Provincia</th>
                    <th data-sort="pais" class="sortable hidden lg:table-cell">País</th>
                    <th data-sort="recontactos" class="sortable text-center">Recontactos</th>
                    <th data-sort="contacto" class="sortable hidden sm:table-cell">Último Contacto</th>
                    <th>Enviado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr><td colspan="10" class="text-center py-4 text-gray-500">Cargando negocios...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- Modal de Agregar/Editar Negocio -->
    <div id="business-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-start mb-4 border-b pb-2">
                <h2 id="modal-title" class="text-2xl font-bold text-gray-800">Agregar Nuevo Negocio</h2>
                <span class="close text-gray-500 hover:text-gray-900 text-2xl cursor-pointer">&times;</span>
            </div>
            <form id="business-form">
                <input type="hidden" id="business-id">
                
                <div class="mb-4">
                    <label for="modal-nombre" class="block text-sm font-medium text-gray-700">Nombre del Negocio:</label>
                    <input type="text" id="modal-nombre" required class="w-full p-2 border border-gray-300 rounded-lg mt-1">
                </div>

                <div class="mb-4">
                    <label for="modal-telefono" class="block text-sm font-medium text-gray-700">Teléfono (WhatsApp):</label>
                    <input type="text" id="modal-telefono" required class="w-full p-2 border border-gray-300 rounded-lg mt-1" placeholder="Ej: +54 9 11 1234 5678">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="modal-rubro" class="block text-sm font-medium text-gray-700">Rubro:</label>
                        <select id="modal-rubro" required class="w-full p-2 border border-gray-300 rounded-lg mt-1"></select>
                    </div>
                    <div>
                        <label for="modal-pais" class="block text-sm font-medium text-gray-700">País:</label>
                        <select id="modal-pais" required class="w-full p-2 border border-gray-300 rounded-lg mt-1"></select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="modal-provincia" class="block text-sm font-medium text-gray-700">Provincia:</label>
                        <select id="modal-provincia" class="w-full p-2 border border-gray-300 rounded-lg mt-1"></select>
                    </div>
                    <div>
                        <label for="modal-ciudad" class="block text-sm font-medium text-gray-700">Ciudad:</label>
                        <select id="modal-ciudad" class="w-full p-2 border border-gray-300 rounded-lg mt-1"></select>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-full">
                    Guardar Negocio
                </button>
            </form>
        </div>
    </div>

    <!-- Modal de Contacto y Historial -->
    <div id="contact-modal" class="modal">
        <div class="modal-content max-w-lg">
            <div class="flex justify-between items-start mb-4 border-b pb-2">
                <h2 class="text-2xl font-bold text-gray-800">Registrar Contacto para: <span id="contact-business-name" class="text-blue-600"></span></h2>
                <span id="contact-modal-close" class="text-gray-500 hover:text-gray-900 text-2xl cursor-pointer">&times;</span>
            </div>

            <!-- Formulario de Registro de Nuevo Contacto -->
            <form id="register-contact-form" class="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <h3 class="text-lg font-semibold mb-3">Nuevo Recontacto</h3>
                <input type="hidden" id="contact-business-id">
                
                <div class="mb-3">
                    <label for="contact-medio" class="block text-sm font-medium text-gray-700">Medio de Contacto:</label>
                    <select id="contact-medio" required class="w-full p-2 border border-gray-300 rounded-lg mt-1">
                        <option value="">Seleccionar Medio</option>
                        <option value="Whatsapp">Whatsapp</option>
                        <option value="Llamada">Llamada</option>
                        <option value="Email">Email</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="contact-notas" class="block text-sm font-medium text-gray-700">Notas:</label>
                    <textarea id="contact-notas" rows="3" required class="w-full p-2 border border-gray-300 rounded-lg mt-1" placeholder="Detalles de la conversación..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    Registrar
                </button>
            </form>

            <!-- Historial de Contacto -->
            <h3 class="text-lg font-semibold mb-3 border-b pb-2">Historial de Interacciones</h3>
            <ul id="contact-history-list" class="max-h-60 overflow-y-auto text-sm text-gray-700">
                <!-- Se llenará con JavaScript -->
            </ul>
        </div>
    </div>
    
    <!-- Modal de Confirmación de Eliminación (Reemplazo de confirm()) -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content max-w-sm text-center">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Confirmar Eliminación</h2>
            <p id="delete-confirm-message" class="text-gray-700 mb-6">¿Estás seguro de que quieres eliminar este negocio?</p>
            <div class="flex justify-around space-x-4">
                <button id="btn-delete-cancel" class="btn bg-gray-300 text-gray-800 hover:bg-gray-400">Cancelar</button>
                <button id="btn-delete-confirm" class="btn btn-danger">Eliminar</button>
            </div>
        </div>
    </div>

<script src="app.js" defer></script>
</body>
</html>
